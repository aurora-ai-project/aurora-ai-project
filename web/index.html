<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Aurora Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:20px;line-height:1.4;background:#0b0f14;color:#e6edf3}
    h1{font-size:22px;margin:0 0 12px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:#111624;border:1px solid #1d263b;border-radius:14px;padding:14px;min-width:260px;box-shadow:0 1px 12px rgba(0,0,0,.15)}
    button,input{font:inherit;padding:8px 10px;border-radius:10px;border:1px solid #2b344d;background:#0e1422;color:#e6edf3}
    button{cursor:pointer}
    table{width:100%;border-collapse:collapse}
    td,th{border-bottom:1px solid #1d263b;padding:6px 8px;font-size:13px}
    code{background:#0e1422;border:1px solid #1d263b;padding:1px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>ðŸ”­ Aurora Portal</h1>
  <div class="row">
    <div class="card">
      <h3>Status</h3>
      <div id="status">Loadingâ€¦</div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button onclick="post(/tick/start)">Start</button>
        <button onclick="post(/tick/stop)">Stop</button>
        <button onclick="post(/tick/once)">Tick once</button>
      </div>
    </div>
    <div class="card">
      <h3>Price</h3>
      <div style="display:flex;gap:6px">
        <input id="price" type="number" step="0.01" placeholder="e.g. 100.0"/>
        <button onclick="pushPrice()">Push</button>
      </div>
      <div style="margin-top:8px">
        <button onclick="decide()">Decide</button>
        <button onclick="trade(buy)">Buy</button>
        <button onclick="trade(sell)">Sell</button>
        <button onclick="trade(hold)">Hold</button>
      </div>
      <pre id="decision" style="white-space:pre-wrap;margin-top:8px"></pre>
    </div>
    <div class="card">
      <h3>Account</h3>
      <pre id="account">Loadingâ€¦</pre>
    </div>
    <div class="card">
      <h3>Plugins</h3>
      <pre id="plugins">Loadingâ€¦</pre>
      <button onclick="reloadPlugins()">Reload</button>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>Trade Log (tail)</h3>
    <table>
      <thead><tr><th>Line</th></tr></thead>
      <tbody id="log"></tbody>
    </table>
  </div>

<script>
const base = "";

async function get(p){ const r = await fetch(base+p); return r.json(); }
async function post(p, body){ const r = await fetch(base+p, {method:"POST", headers:{content-type:application/json}, body: body?JSON.stringify(body):null}); return r.json(); }

async function refresh(){
  const s = await get("/status");
  document.getElementById("status").innerHTML = `<div>running: <code>${s.running}</code></div>
    <div>last_tick: <code>${s.last_tick ?? "â€“"}</code></div>
    <div>buffered prices: <code>${s.prices}</code></div>`;
  const a = await get("/account/status");
  document.getElementById("account").textContent = JSON.stringify(a,null,2);
  const p = await get("/plugins");
  document.getElementById("plugins").textContent = JSON.stringify(p.loaded,null,2);
  const log = await get("/logs/trades/tail?n=50");
  const tbody = document.getElementById("log"); tbody.innerHTML = "";
  for (const ln of log.lines) {
    const tr = document.createElement("tr"); const td=document.createElement("td");
    td.textContent = ln; tr.appendChild(td); tbody.appendChild(tr);
  }
}

async function pushPrice(){
  const v = parseFloat(document.getElementById("price").value);
  if (!isFinite(v)) { alert("Enter a price"); return; }
  await post("/price/push", {price:v}); await refresh();
}

async function decide(){
  const d = await post("/decide");
  document.getElementById("decision").textContent = JSON.stringify(d,null,2);
}

async function trade(act){
  const r = await post("/trade/execute", {action: act});
  document.getElementById("decision").textContent = JSON.stringify(r,null,2);
  await refresh();
}

async function reloadPlugins(){ await post("/plugins/reload"); await refresh(); }

refresh(); setInterval(refresh, 2000);
</script>
</body>
</html>
